"0","library(ggplot2)"
"0",""
"0","sensitivity_test <- function(income_all, year_seq, fill_method) {"
"0","  df <- income_all %>%"
"0","    group_by(`MSOA code`, `MSOA name`,"
"0","             `Local authority code`, `Local authority name`) %>%"
"0","    complete(year = year_seq) %>%"
"0","    arrange(year)"
"0","  "
"0","  if (fill_method == ""Linear LOCF"") {"
"0","    df <- df %>%"
"0","      mutate(income = na.approx(income, x = year, na.rm = FALSE)) %>%"
"0","      mutate(income = na.locf(income, na.rm = FALSE)) %>%"
"0","      mutate(income = na.locf(income, fromLast = TRUE, na.rm = FALSE))"
"0","    } else if (fill_method == ""Cubic Spline"") {"
"0","    df <- df %>%"
"0","      group_by(`MSOA code`) %>%"
"0","      mutate(income = spline(year, income, xout = year_seq)$y) %>%"
"0","      ungroup() %>%"
"0","      mutate(income = na.locf(income, na.rm = FALSE)) %>%"
"0","      mutate(income = na.locf(income, fromLast = TRUE, na.rm = FALSE))"
"0","    } else if (fill_method == ""LOCF Forward"") {"
"0","    df <- df %>%"
"0","      mutate(income = na.locf(income, na.rm = FALSE))"
"0","    } else if (fill_method == ""No Fill"") {"
"0","    df <- df}"
"0","  "
"0","  df <- df %>% ungroup() %>% mutate(method = fill_method)"
"0","  return(df)}"
"0",""
"0","year_seq <- seq(2011, 2022, by = 0.5)"
"0",""
"0","results_linear <- sensitivity_test(income_all, year_seq, ""Linear LOCF"")"
"0","results_spline <- sensitivity_test(income_all, year_seq, ""Cubic Spline"")"
"0","results_locf   <- sensitivity_test(income_all, year_seq, ""LOCF Forward"")"
"0","results_no_fill<- sensitivity_test(income_all, year_seq, ""No Fill"")"
"0",""
"0","all_results <- bind_rows(results_linear, results_spline, results_locf, results_no_fill)"
"0",""
"0","ggplot(all_results, aes(x = year, y = income, color = method)) +"
"0","  geom_line() +"
"0","  facet_wrap(~ `MSOA code`, scales = ""free_y"") +"
"0","  labs(title = ""Sensitivity Test: Income Interpolation Methods"","
"0","       x = ""Year"", y = ""Income (Â£)"") +"
"0","  theme_minimal()"
