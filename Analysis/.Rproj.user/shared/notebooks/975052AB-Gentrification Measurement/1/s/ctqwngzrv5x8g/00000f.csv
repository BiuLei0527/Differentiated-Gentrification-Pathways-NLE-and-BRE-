"0","prepare_did_data_v2 <- function() {"
"0","  all_lsoa <- all_lsoa"
"0","  nle_lsoas <- nle_affected_new$LSOA11CD  # 35 LSOAs"
"0","  bre_lsoas <- bre_affected_new$LSOA11CD  # 4 LSOAs"
"0","  NLE_INTERVENTION_YEAR <- 2015"
"0","  BRE_INTERVENTION_YEAR <- 2016"
"0",""
"0","  cat(""Treatment Groups:\n"")"
"0","  cat(""- NLE (intervention: 2015):"", length(nle_lsoas), ""LSOAs\n"")"
"0","  cat(""- BRE (intervention: 2016):"", length(bre_lsoas), ""LSOAs\n\n"")"
"0",""
"0","  if (!""dist_to_nle_station"" %in% names(all_lsoa)) {"
"0","    library(sf)"
"0",""
"0","    lsoa_sf <- all_lsoa %>%"
"0","      st_transform(27700)"
"0","    nle_sf <- nine_elms_station %>%"
"0","      st_transform(27700)"
"0","    bre_sf <- bre_station %>%"
"0","      st_transform(27700)"
"0",""
"0","    dist_matrix_nle <- st_distance(lsoa_sf, nle_sf)"
"0","    all_lsoa$dist_to_nle_station <- as.numeric(apply(dist_matrix_nle, 1, min))"
"0",""
"0","    dist_matrix_bre <- st_distance(lsoa_sf, bre_sf)"
"0","    all_lsoa$dist_to_bre_station <- as.numeric(apply(dist_matrix_bre, 1, min))}"
"0",""
"0","  cat(""Data Validation:\n"")"
"0","  cat(""- Total LSOAs:"", nrow(all_lsoa), ""\n"")"
"0","  cat(""- House price 2014 available:"", sum(!is.na(all_lsoa$median_price_2014)), ""\n"")"
"0","  cat(""- House price 2015 available:"", sum(!is.na(all_lsoa$median_price_2015)), ""\n"")"
"0",""
"0","  return(list("
"0","    all_lsoa = all_lsoa,"
"0","    nle_lsoas = nle_lsoas,"
"0","    bre_lsoas = bre_lsoas,"
"0","    nle_year = NLE_INTERVENTION_YEAR,"
"0","    bre_year = BRE_INTERVENTION_YEAR))}"
"0",""
"0","select_controls_complete <- function(all_lsoa, treatment_lsoas,"
"0","                                    project_type, dist_to_station) {"
"0",""
"0","  if(project_type == ""NLE"") {"
"0","    "
"0","    INTERVENTION_YEAR <- 2015"
"0","    BASELINE_YEAR <- 2014"
"0","    "
"0","    baseline_data <- all_lsoa %>%"
"0","      mutate(treatment = ifelse(LSOA11CD %in% treatment_lsoas, 1, 0),"
"0","        dist = dist_to_station,"
"0","        intervention_year = INTERVENTION_YEAR,"
"0",""
"0","        ptal_baseline = PTAL_Value_2014,"
"0","        imd_baseline = imd2010,"
"0","        pop_baseline = population_2014,"
"0","        price_baseline = median_price_2014,"
"0","        "
"0","        ptal_trend_short = (PTAL_Value_2014 - PTAL_Value_2012)/2,"
"0","        pop_trend_short = (population_2014 - population_2012)/2,"
"0","  "
"0","        ptal_trend_long = (PTAL_Value_2014 - PTAL_Value_2007)/7,"
"0","        imd_trend_long = (imd2010 - imd2004)/6,"
"0","        pop_trend_long = (population_2014 - population_2011)/3)"
"0","    "
"0","  } else if(project_type == ""BRE"") {"
"0","    INTERVENTION_YEAR <- 2016"
"0","    BASELINE_YEAR <- 2015"
"0","    "
"0","    cat(""ðŸ“… Barking Riverside Extension\n"")"
"0","    cat(""   Intervention: 2016, Baseline: 2015\n\n"")"
"0","    "
"0","    baseline_data <- all_lsoa %>%"
"0","      mutate(treatment = ifelse(LSOA11CD %in% treatment_lsoas, 1, 0),"
"0","        dist = dist_to_station,"
"0","        intervention_year = INTERVENTION_YEAR,"
"0","   "
"0","        ptal_baseline = PTAL_Value_2015,"
"0","        imd_baseline = imd2015,"
"0","        pop_baseline = population_2015,"
"0","        price_baseline = median_price_2015,"
"0","   "
"0","        ptal_trend_short = (PTAL_Value_2015 - PTAL_Value_2014)/1,"
"0","        imd_trend_short = (imd2015 - imd2010)/5,"
"0","        pop_trend_short = (population_2015 - population_2014)/1,"
"0","  "
"0","        ptal_trend_long = (PTAL_Value_2015 - PTAL_Value_2007)/8,"
"0","        imd_trend_long = (imd2015 - imd2004)/11,"
"0","        pop_trend_long = (population_2015 - population_2011)/4)}"
"0","  "
"0","  n_treated <- sum(baseline_data$treatment == 1)"
"0","  "
"0","  treat_summary <- baseline_data %>%"
"0","    filter(treatment == 1) %>%"
"0","    summarise(n = n(),"
"0","      mean_ptal = mean(ptal_baseline, na.rm = TRUE),"
"0","      mean_imd = mean(imd_baseline, na.rm = TRUE),"
"0","      mean_pop = mean(pop_baseline, na.rm = TRUE),"
"0","      mean_price = mean(price_baseline, na.rm = TRUE),"
"0",""
"0","      mean_ptal_trend = mean(ptal_trend_long, na.rm = TRUE),"
"0","      mean_imd_trend = mean(imd_trend_long, na.rm = TRUE),"
"0","      mean_pop_trend = mean(pop_trend_long, na.rm = TRUE))"
"0","  "
"0","  cat(""ðŸ“Š Treatment Group (n="", treat_summary$n, ""):\n"", sep="""")"
"0","  cat(""\n   Baseline Values:\n"")"
"0","  cat(""   - PTAL:"", round(treat_summary$mean_ptal, 2), ""\n"")"
"0","  cat(""   - IMD:"", round(treat_summary$mean_imd, 2), ""\n"")"
"0","  cat(""   - Population:"", format(round(treat_summary$mean_pop, 0), big.mark="",""), ""\n"")"
"0","  cat(""   - House Price: Â£"", format(round(treat_summary$mean_price, 0), big.mark="",""), ""\n"")"
"0","  "
"0","  cat(""\n   Pre-treatment Trends:\n"")"
"0","  cat(""   - PTAL trend:"", round(treat_summary$mean_ptal_trend, 3), ""/year\n"")"
"0","  cat(""   - IMD trend:"", round(treat_summary$mean_imd_trend, 3), ""/year\n"")"
"0","  cat(""   - Pop trend:"", round(treat_summary$mean_pop_trend, 0), ""/year\n\n"")"
"0",""
"0","  potential_controls <- baseline_data %>%"
"0","    filter(treatment == 0,"
"0","      dist >= 1500 & dist <= 8000,"
"0","      !is.na(ptal_baseline),"
"0","      !is.na(imd_baseline),"
"0","      !is.na(pop_baseline),"
"0","      !is.na(ptal_trend_long),  "
"0","      !is.na(imd_trend_long))"
"0","  "
"0","  cat(""ðŸ” Potential controls found:"", nrow(potential_controls), ""\n"")"
"0","  "
"0","  cat(""\nðŸ“ˆ Checking data variation:\n"")"
"0","  for(var in c(""ptal_baseline"", ""imd_baseline"", ""ptal_trend_long"")) {"
"0","    var_sd <- sd(potential_controls[[var]], na.rm = TRUE)"
"0","    cat(""   SD of"", var, "":"", round(var_sd, 3), ""\n"")}"
"0","  "
"0","  if(n_treated <= 4) {"
"0","    match_ratio <- 5"
"0","    caliper_val <- 0.5 "
"0","  } else if(n_treated <= 10) {"
"0","    match_ratio <- 3"
"0","    caliper_val <- 0.3"
"0","  } else {"
"0","    match_ratio <- 2"
"0","    caliper_val <- 0.25"
"0","  }"
"0","  "
"0","  cat(""\nâš™ï¸ Matching Configuration:\n"")"
"0","  cat(""   Target ratio: 1:"", match_ratio, ""\n"")"
"0","  cat(""   Caliper:"", caliper_val, ""SD\n\n"")"
"0","  "
"0","  matched_data <- NULL"
"0","  matching_method <- NULL"
"0","  "
"0","  tryCatch({"
"0","    psm_full <- matchit("
"0","      treatment ~ ptal_baseline + imd_baseline + log(pop_baseline + 1) +"
"0","                  ptal_trend_long + imd_trend_long + pop_trend_long,"
"0","      data = bind_rows("
"0","        baseline_data %>% filter(treatment == 1),"
"0","        potential_controls),"
"0","      method = ""nearest"","
"0","      distance = ""logit"","
"0","      ratio = match_ratio,"
"0","      caliper = caliper_val,"
"0","      replace = FALSE)"
"0","    "
"0","    matched_data <- match.data(psm_full)"
"0","    matching_method <- ""Full PSM with trends"""
"0","    cat(""âœ“ Success!\n"")"
"0","    }, error = function(e) {"
"0","    cat(""âœ— Failed:"", substr(e$message, 1, 50), ""...\n"")})"
"0",""
"0","  if(is.null(matched_data)) {"
"0","    cat(""\nTry 2: Simplified PSM (baseline + key trends)...\n"")"
"0","    "
"0","    tryCatch({"
"0","      psm_simple <- matchit("
"0","        treatment ~ ptal_baseline + imd_baseline + ptal_trend_long,"
"0","        data = bind_rows("
"0","          baseline_data %>% filter(treatment == 1),"
"0","          potential_controls),"
"0","        method = ""nearest"","
"0","        distance = ""logit"","
"0","        ratio = match_ratio,"
"0","        caliper = caliper_val * 1.5, "
"0","        replace = TRUE)"
"0","      "
"0","      matched_data <- match.data(psm_simple)"
"0","      matching_method <- ""Simplified PSM"""
"0","      cat(""âœ“ Success!\n"")"
"0","      "
"0","    }, error = function(e) {cat(""âœ— Failed:"", substr(e$message, 1, 50), ""...\n"")})}"
"0","  "
"0","  if(is.null(matched_data)) {"
"0","    cat(""\nTry 3: Mahalanobis distance with trends...\n"")"
"0","    "
"0","    tryCatch({match_vars <- c(""ptal_baseline"", ""imd_baseline"", ""pop_baseline"","
"0","                     ""ptal_trend_long"", ""imd_trend_long"")"
"0","      "
"0","      data_for_match <- bind_rows("
"0","        baseline_data %>% filter(treatment == 1),"
"0","        potential_controls) %>%"
"0","        select(all_of(c(""treatment"", match_vars, ""LSOA11CD""))) %>%"
"0","        na.omit()"
"0","      "
"0","      maha_match <- matchit("
"0","        treatment ~ ptal_baseline + imd_baseline + pop_baseline +"
"0","                    ptal_trend_long + imd_trend_long,"
"0","        data = data_for_match,"
"0","        method = ""nearest"","
"0","        distance = ""mahalanobis"","
"0","        ratio = match_ratio,"
"0","        replace = FALSE)"
"0","      "
"0","      matched_data <- match.data(maha_match)"
"0","      "
"0","      matched_data <- matched_data %>%"
"0","        left_join(baseline_data %>% "
"0","                   select(-treatment), "
"0","                 by = ""LSOA11CD"")"
"0","      "
"0","      matching_method <- ""Mahalanobis with trends"""
"0","      cat(""âœ“ Success!\n"")"
"0","      "
"0","    }, error = function(e) {"
"0","      cat(""âœ— Failed:"", substr(e$message, 1, 50), ""...\n"")})}"
"0",""
"0","  if(is.null(matched_data)) {"
"0","    cat(""\nTry 4: Direct selection based on trend similarity...\n"")"
"0",""
"0","    potential_controls <- potential_controls %>%"
"0","      mutate(ptal_diff = abs(ptal_baseline - treat_summary$mean_ptal) / "
"0","                   sd(baseline_data$ptal_baseline, na.rm = TRUE),"
"0","        imd_diff = abs(imd_baseline - treat_summary$mean_imd) / "
"0","                  sd(baseline_data$imd_baseline, na.rm = TRUE),"
"0","        "
"0","        ptal_trend_diff = abs(ptal_trend_long - treat_summary$mean_ptal_trend) / "
"0","                         sd(baseline_data$ptal_trend_long, na.rm = TRUE),"
"0","        imd_trend_diff = abs(imd_trend_long - treat_summary$mean_imd_trend) / "
"0","                        sd(baseline_data$imd_trend_long, na.rm = TRUE),"
"0","        "
"0","        total_distance = 0.2 * ptal_diff + "
"0","                        0.2 * imd_diff + "
"0","                        0.3 * ptal_trend_diff + "
"0","                        0.3 * imd_trend_diff) %>% "
"0","      arrange(total_distance)"
"0","    "
"0","    n_controls <- min(n_treated * match_ratio, nrow(potential_controls))"
"0","    "
"0","    selected_controls <- potential_controls %>%"
"0","      slice_head(n = n_controls)"
"0","    "
"0","    matched_data <- bind_rows("
"0","      baseline_data %>% filter(treatment == 1),"
"0","      selected_controls)"
"0","    "
"0","    matching_method <- ""Direct trend-based selection"""
"0","    cat(""âœ“ Selected"", n_controls, ""most similar controls\n"")}"
"0","  "
"0",""
"0","  "
"0","  if(!is.null(matched_data)) {"
"0","    cat(""\n========================================\n"")"
"0","    cat(""MATCHING RESULTS -"", matching_method, ""\n"")"
"0","    cat(""========================================\n\n"")"
"0","    "
"0","    cat(""ðŸ“Š Sample Size:\n"")"
"0","    cat(""   Treatment:"", sum(matched_data$treatment == 1), ""\n"")"
"0","    cat(""   Control:"", sum(matched_data$treatment == 0), ""\n"")"
"0","    cat(""   Ratio: 1:"", "
"0","        round(sum(matched_data$treatment == 0)/sum(matched_data$treatment == 1), 1), ""\n\n"")"
"0","    "
"0","    vars_to_check <- list("
"0","      ""Baseline"" = c(""ptal_baseline"", ""imd_baseline"", ""pop_baseline""),"
"0","      ""Trends"" = c(""ptal_trend_long"", ""imd_trend_long"", ""pop_trend_long""))"
"0","    "
"0","    cat(""ðŸ“ˆ Balance Assessment (SMD):\n"")"
"0","    "
"0","    all_smds <- c()"
"0","    "
"0","    for(category in names(vars_to_check)) {"
"0","      cat(""\n   "", category, "":\n"", sep="""")"
"0","      "
"0","      for(var in vars_to_check[[category]]) {"
"0","        if(var %in% names(matched_data) && "
"0","           sum(!is.na(matched_data[[var]])) > 0) {"
"0","          "
"0","          treat_mean <- mean(matched_data[[var]][matched_data$treatment==1], na.rm=TRUE)"
"0","          control_mean <- mean(matched_data[[var]][matched_data$treatment==0], na.rm=TRUE)"
"0","          pooled_sd <- sd(matched_data[[var]], na.rm=TRUE)"
"0","          "
"0","          if(pooled_sd > 0) {"
"0","            smd <- abs(treat_mean - control_mean) / pooled_sd"
"0","          } else {smd <- 0}"
"0","          "
"0","          all_smds <- c(all_smds, smd)"
"0","     "
"0","          var_name <- gsub(""_baseline|_trend_long"", """", var)"
"0","          status <- ifelse(smd < 0.1, ""âœ…"", "
"0","                          ifelse(smd < 0.25, ""âš ï¸"", ""âŒ""))"
"0","          "
"0","          cat(sprintf(""   - %-10s: %.3f %s\n"", var_name, smd, status))}}}"
"0","    "
"0","    mean_smd <- mean(all_smds, na.rm = TRUE)"
"0","    cat(""\nðŸ“Š Overall Balance:\n"")"
"0","    cat(""   Mean SMD:"", sprintf(""%.3f"", mean_smd), ""\n"")"
"0","    "
"0","    if(mean_smd < 0.15) {"
"0","      cat(""   Grade: Good âœ…\n"")"
"0","      cat(""   âžœ Proceed with DID analysis\n"")"
"0","    } else if(mean_smd < 0.25) {"
"0","      cat(""   Grade: Acceptable âš ï¸\n"")"
"0","      cat(""   âžœ Use with covariate adjustment\n"")"
"0","    } else {cat(""   Grade: Poor âŒ\n"")"
"0","      cat(""   âžœ Consider alternative methods\n"")}"
"0","    "
"0","    cat(""\nðŸ” Pre-treatment Parallel Trends Check:\n"")"
"0","    "
"0","    trend_check <- matched_data %>%"
"0","      group_by(treatment) %>%"
"0","      summarise("
"0","        ptal_trend = mean(ptal_trend_long, na.rm = TRUE),"
"0","        imd_trend = mean(imd_trend_long, na.rm = TRUE),"
"0","        .groups = ""drop"")"
"0","    "
"0","    ptal_trend_diff <- abs(diff(trend_check$ptal_trend))"
"0","    imd_trend_diff <- abs(diff(trend_check$imd_trend))"
"0","    "
"0","    cat(""   PTAL trend difference:"", round(ptal_trend_diff, 4), "
"0","        ifelse(ptal_trend_diff < 0.5, ""âœ…"", ""âš ï¸""), ""\n"")"
"0","    cat(""   IMD trend difference:"", round(imd_trend_diff, 4),"
"0","        ifelse(imd_trend_diff < 2, ""âœ…"", ""âš ï¸""), ""\n"")"
"0","    "
"0","    if(ptal_trend_diff < 0.5 && imd_trend_diff < 2) {"
"0","      cat(""   âžœ Good evidence for parallel trends\n"")"
"0","    } else {cat(""   âžœ Trends may differ - verify with full test\n"")"
"0","    }} else {cat(""\nâŒ All matching strategies failed!\n"")"
"0","    cat(""Recommendations:\n"")"
"0","    cat(""1. Check data quality and missing values\n"")"
"0","    cat(""2. Consider synthetic control method\n"")"
"0","    cat(""3. Expand search radius or relax criteria\n"")}"
"0","  return(matched_data)}"
"0",""
"0",""
"0","data_v2 <- prepare_did_data_v2()"
"1","Treatment Groups:
"
"1","- NLE (intervention: 2015):"
"1"," "
"1","35"
"1"," "
"1","LSOAs
"
"1","- BRE (intervention: 2016):"
"1"," "
"1","4"
"1"," "
"1","LSOAs

"
"1","Data Validation:
"
"1","- Total LSOAs:"
"1"," "
"1","4835"
"1"," "
"1","
"
"1","- House price 2014 available:"
"1"," "
"1","4835"
"1"," "
"1","
"
"1","- House price 2015 available:"
"1"," "
"1","4835"
"1"," "
"1","
"
"0","nle_matched_final <- select_controls_complete("
"0","  all_lsoa = data_v2$all_lsoa,"
"0","  treatment_lsoas = data_v2$nle_lsoas,"
"0","  project_type = ""NLE"","
"0","  dist_to_station = data_v2$all_lsoa$dist_to_nle_station)"
"1","ðŸ“Š Treatment Group (n="
"1",""
"1","35"
"1",""
"1","):
"
"1","
   Baseline Values:
"
"1","   - PTAL:"
"1"," "
"1","22.14"
"1"," "
"1","
"
"1","   - IMD:"
"1"," "
"1","30.98"
"1"," "
"1","
"
"1","   - Population:"
"1"," "
"1","1,799"
"1"," "
"1","
"
"1","   - House Price: Â£"
"1"," "
"1","487,547"
"1"," "
"1","
"
"1","
   Pre-treatment Trends:
"
"1","   - PTAL trend:"
"1"," "
"1","-0.038"
"1"," "
"1","/year
"
"1","   - IMD trend:"
"1"," "
"1","-0.919"
"1"," "
"1","/year
"
"1","   - Pop trend:"
"1"," "
"1","25"
"1"," "
"1","/year

"
"1","ðŸ” Potential controls found:"
"1"," "
"1","1246"
"1"," "
"1","
"
"1","
ðŸ“ˆ Checking data variation:
"
"1","   SD of"
"1"," "
"1","ptal_baseline"
"1"," "
"1",":"
"1"," "
"1","16.776"
"1"," "
"1","
"
"1","   SD of"
"1"," "
"1","imd_baseline"
"1"," "
"1",":"
"1"," "
"1","11.985"
"1"," "
"1","
"
"1","   SD of"
"1"," "
"1","ptal_trend_long"
"1"," "
"1",":"
"1"," "
"1","0.882"
"1"," "
"1","
"
"1","
âš™ï¸ Matching Configuration:
"
"1","   Target ratio: 1:"
"1"," "
"1","2"
"1"," "
"1","
"
"1","   Caliper:"
"1"," "
"1","0.25"
"1"," "
"1","SD

"
"1","âœ“ Success!
"
"1","
========================================
"
"1","MATCHING RESULTS -"
"1"," "
"1","Full PSM with trends"
"1"," "
"1","
"
"1","========================================

"
"1","ðŸ“Š Sample Size:
"
"1","   Treatment:"
"1"," "
"1","35"
"1"," "
"1","
"
"1","   Control:"
"1"," "
"1","70"
"1"," "
"1","
"
"1","   Ratio: 1:"
"1"," "
"1","2"
"1"," "
"1","

"
"1","ðŸ“ˆ Balance Assessment (SMD):
"
"1","
   "
"1",""
"1","Baseline"
"1",""
"1",":
"
"1","   - ptal      : 0.045 âœ…
"
"1","   - imd       : 0.082 âœ…
"
"1","   - pop       : 0.061 âœ…
"
"1","
   "
"1",""
"1","Trends"
"1",""
"1",":
"
"1","   - ptal      : 0.029 âœ…
"
"1","   - imd       : 0.021 âœ…
"
"1","   - pop       : 0.034 âœ…
"
"1","
ðŸ“Š Overall Balance:
"
"1","   Mean SMD:"
"1"," "
"1","0.045"
"1"," "
"1","
"
"1","   Grade: Good âœ…
"
"1","   âžœ Proceed with DID analysis
"
"1","
ðŸ” Pre-treatment Parallel Trends Check:
"
"1","   PTAL trend difference:"
"1"," "
"1","0.0105"
"1"," "
"1","âœ…"
"1"," "
"1","
"
"1","   IMD trend difference:"
"1"," "
"1","0.0202"
"1"," "
"1","âœ…"
"1"," "
"1","
"
"1","   âžœ Good evidence for parallel trends
"
"0","bre_matched_final <- select_controls_complete("
"0","  all_lsoa = data_v2$all_lsoa,"
"0","  treatment_lsoas = data_v2$bre_lsoas,"
"0","  project_type = ""BRE"","
"0","  dist_to_station = data_v2$all_lsoa$dist_to_bre_station)"
"1","ðŸ“… Barking Riverside Extension
"
"1","   Intervention: 2016, Baseline: 2015

"
"1","ðŸ“Š Treatment Group (n="
"1",""
"1","4"
"1",""
"1","):
"
"1","
   Baseline Values:
"
"1","   - PTAL:"
"1"," "
"1","3.45"
"1"," "
"1","
"
"1","   - IMD:"
"1"," "
"1","38.17"
"1"," "
"1","
"
"1","   - Population:"
"1"," "
"1","2,588"
"1"," "
"1","
"
"1","   - House Price: Â£"
"1"," "
"1","215,499"
"1"," "
"1","
"
"1","
   Pre-treatment Trends:
"
"1","   - PTAL trend:"
"1"," "
"1","0.084"
"1"," "
"1","/year
"
"1","   - IMD trend:"
"1"," "
"1","-0.07"
"1"," "
"1","/year
"
"1","   - Pop trend:"
"1"," "
"1","168"
"1"," "
"1","/year

"
"1","ðŸ” Potential controls found:"
"1"," "
"1","638"
"1"," "
"1","
"
"1","
ðŸ“ˆ Checking data variation:
"
"1","   SD of"
"1"," "
"1","ptal_baseline"
"1"," "
"1",":"
"1"," "
"1","6.375"
"1"," "
"1","
"
"1","   SD of"
"1"," "
"1","imd_baseline"
"1"," "
"1",":"
"1"," "
"1","10.998"
"1"," "
"1","
"
"1","   SD of"
"1"," "
"1","ptal_trend_long"
"1"," "
"1",":"
"1"," "
"1","0.187"
"1"," "
"1","
"
"1","
âš™ï¸ Matching Configuration:
"
"1","   Target ratio: 1:"
"1"," "
"1","5"
"1"," "
"1","
"
"1","   Caliper:"
"1"," "
"1","0.5"
"1"," "
"1","SD

"
"2","Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred"
"1","âœ“ Success!
"
"1","
========================================
"
"1","MATCHING RESULTS -"
"1"," "
"1","Full PSM with trends"
"1"," "
"1","
"
"1","========================================

"
"1","ðŸ“Š Sample Size:
"
"1","   Treatment:"
"1"," "
"1","2"
"1"," "
"1","
"
"1","   Control:"
"1"," "
"1","5"
"1"," "
"1","
"
"1","   Ratio: 1:"
"1"," "
"1","2.5"
"1"," "
"1","

"
"1","ðŸ“ˆ Balance Assessment (SMD):
"
"1","
   "
"1",""
"1","Baseline"
"1",""
"1",":
"
"1","   - ptal      : 0.019 âœ…
"
"1","   - imd       : 1.181 âŒ
"
"1","   - pop       : 0.359 âŒ
"
"1","
   "
"1",""
"1","Trends"
"1",""
"1",":
"
"1","   - ptal      : 0.327 âŒ
"
"1","   - imd       : 0.908 âŒ
"
"1","   - pop       : 0.600 âŒ
"
"1","
ðŸ“Š Overall Balance:
"
"1","   Mean SMD:"
"1"," "
"1","0.566"
"1"," "
"1","
"
"1","   Grade: Poor âŒ
"
"1","   âžœ Consider alternative methods
"
"1","
ðŸ” Pre-treatment Parallel Trends Check:
"
"1","   PTAL trend difference:"
"1"," "
"1","0.012"
"1"," "
"1","âœ…"
"1"," "
"1","
"
"1","   IMD trend difference:"
"1"," "
"1","0.7343"
"1"," "
"1","âœ…"
"1"," "
"1","
"
"1","   âžœ Good evidence for parallel trends
"
"0","if(!dir.exists(""output_final"")) dir.create(""output_final"")"
"0",""
"0","if(!is.null(nle_matched_final)) {"
"0","  write_csv(nle_matched_final, ""output_final/nle_matched_with_trends.csv"")"
"0","  cat(""\nâœ… NLE matching saved\n"")"
"0","}"
"1","
âœ… NLE matching saved
"
"0","if(!is.null(bre_matched_final)) {"
"0","  write_csv(bre_matched_final, ""output_final/bre_matched_with_trends.csv"")"
"0","  cat(""\nâœ… BRE matching saved\n"")}"
"1","
âœ… BRE matching saved
"
