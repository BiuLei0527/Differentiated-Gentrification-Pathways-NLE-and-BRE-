"0","library(ggplot2)"
"0","library(gridExtra)"
"0","library(dplyr)"
"0","library(tidyr)"
"0","library(grid)"
"0",""
"0","theme_set(theme_minimal())"
"0",""
"0","# Updated data based on new results"
"0","data <- data.frame("
"0","  Outcome = c(""income"", ""crime_rate"", ""house_price"", ""mobility"","
"0","              ""income"", ""crime_rate"", ""house_price"", ""mobility""),"
"0","  Simple_DID = c(1447.579, 0, 9028.348, -0.007,"
"0","                 3922.664, -0.002, -27652.532, -0.103),"
"0","  Standard_DID = c(1447.235, 0, 9008.942, -0.007,"
"0","                   3613.05, -0.002, -23572.147, -0.087),"
"0","  No_COVID = c(1324.788, 0.001, 9182.995, -0.006,"
"0","               3284.892, -0.002, -29037.775, -0.08),"
"0","  SLM_Direct = c(1096.015, 0, 4645.546, 0,"
"0","                 3613.246, -0.003, -21181.813, -0.087),"
"0","  SLM_Indirect = c(258.896, 0, 22994.778, 0,"
"0","                   -2801.905, -0.016, 63583.768, -0.032),"
"0","  SEM_Coef = c(1203.583, 0, 9885.27, -0.006,"
"0","               3652.298, -0.003, -22553.352, -0.084),"
"0","  SDM_Local = c(1096.015, -0.001, 4645.546, -0.007,"
"0","                3613.246, -0.003, -21181.813, -0.087),"
"0","  KNN5_SLM = c(365.74, 0.017, 39432.044, 0.018,"
"0","               3996.807, -0.002, -24150.776, 0),"
"0","  KNN10_SLM = c(1286.024, 0.006, 7700.061, 0.008,"
"0","                0, 0, 0, 0),"
"0","  Synthetic = c(0, 0, 0, 0,"
"0","                5629.869, -0.01, -27380.429, -0.022),"
"0","  DR_DID = c(1977.929, -0.009, -2709.8, -0.007,"
"0","             3825.675, -0.017, -13861.421, -0.071),"
"0","  Bootstrap = c(1442.158, -0.001, 9122.088, -0.006,"
"0","                3671.577, -0.003, -28618.53, -0.103),"
"0","  Project = c(rep(""NLE"", 4), rep(""BRE"", 4))"
"0",")"
"0",""
"0","# Pivot longer with updated column names"
"0","data_long <- data %>%"
"0","  pivot_longer(cols = c(Simple_DID, Standard_DID, No_COVID,"
"0","                        SLM_Direct, SLM_Indirect, SEM_Coef, SDM_Local,"
"0","                        KNN5_SLM, KNN10_SLM, Synthetic, DR_DID, Bootstrap),"
"0","               names_to = ""Method"","
"0","               values_to = ""Value"")"
"0",""
"0","# Update factor levels and display names"
"0","data_long$Method <- factor(data_long$Method,"
"0","                           levels = c(""Standard_DID"", ""Simple_DID"", ""No_COVID"","
"0","                                      ""DR_DID"", ""Bootstrap"", ""SLM_Direct"", "
"0","                                      ""SLM_Indirect"", ""SEM_Coef"", ""SDM_Local"","
"0","                                      ""KNN5_SLM"", ""KNN10_SLM"", ""Synthetic""))"
"0",""
"0","data_long$Method_Display <- gsub(""_"", "" "", data_long$Method)"
"0","data_long$Method_Display <- gsub(""DID"", ""DiD"", data_long$Method_Display)"
"0","data_long$Method_Display <- gsub(""SLM"", ""SLM"", data_long$Method_Display)"
"0","data_long$Method_Display <- gsub(""SEM"", ""SEM"", data_long$Method_Display)"
"0","data_long$Method_Display <- gsub(""SDM"", ""SDM"", data_long$Method_Display)"
"0","data_long$Method_Display <- gsub(""KNN"", ""KNN"", data_long$Method_Display)"
"0",""
"0","bre_color <- ""#D73027"""
"0","nle_color <- ""#4575B4"""
"0",""
"0","create_chart <- function(outcome_name, y_label, y_limits = NULL) {"
"0","  plot_data <- data_long %>%"
"0","    filter(Outcome == outcome_name)"
"0","  "
"0","  p <- ggplot(plot_data, aes(x = Method_Display, y = Value, fill = Project)) +"
"0","    geom_bar(stat = ""identity"", position = position_dodge(width = 0.8),"
"0","             width = 0.7, alpha = 0.8) +"
"0","    scale_fill_manual(values = c(""BRE"" = bre_color, ""NLE"" = nle_color),"
"0","                      labels = c(""BRE"", ""NLE"")) +"
"0","    labs(x = ""Estimation Method"","
"0","         y = y_label,"
"0","         fill = ""Project"") +"
"0","    theme_minimal() +"
"0","    theme("
"0","      panel.background = element_rect(fill = ""white"", color = NA),"
"0","      panel.grid.major.x = element_blank(),"
"0","      panel.grid.minor = element_blank(),"
"0","      panel.grid.major.y = element_line(color = ""#E0E0E0"", size = 0.5),"
"0","      axis.text.x = element_text(angle = 45, hjust = 1, size = 9, color = ""black""),"
"0","      axis.text.y = element_text(size = 9, color = ""black""),"
"0","      axis.title = element_text(size = 10, color = ""black""),"
"0","      axis.title.x = element_text(margin = margin(t = 10)),"
"0","      axis.title.y = element_text(margin = margin(r = 10)),"
"0","      legend.position = c(0.85, 0.95),"
"0","      legend.direction = ""horizontal"","
"0","      legend.title = element_text(size = 9),"
"0","      legend.text = element_text(size = 8),"
"0","      legend.background = element_rect(fill = ""white"", color = ""grey80""),"
"0","      legend.key.size = unit(0.4, ""cm""),"
"0","      plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), ""cm""))"
"0","  "
"0","  if (!is.null(y_limits)) {"
"0","    p <- p + coord_cartesian(ylim = y_limits)"
"0","  }"
"0","  "
"0","  p <- p + geom_hline(yintercept = 0, linetype = ""solid"", color = ""black"", size = 0.3)"
"0","  "
"0","  return(p)"
"0","}"
"0",""
"0","p1 <- create_chart(""income"", ""Income Effect (£)"") +"
"0","  ggtitle(""A. Impact on Household Income"") +"
"0","  theme(plot.title = element_text(size = 11, hjust = 0.5, face = ""bold""))"
"0",""
"0","p2 <- create_chart(""crime_rate"", ""Crime Rate Change"") +"
"0","  ggtitle(""B. Impact on Crime Rate"") +"
"0","  theme(plot.title = element_text(size = 11, hjust = 0.5, face = ""bold"")) +"
"0","  coord_cartesian(ylim = c(-0.025, 0.025))"
"0",""
"0","p3 <- create_chart(""house_price"", ""House Price Effect (£)"") +"
"0","  ggtitle(""C. Impact on House Prices"") +"
"0","  theme(plot.title = element_text(size = 11, hjust = 0.5, face = ""bold""))"
"0",""
"0","p4 <- create_chart(""mobility"", ""Mobility Change"") +"
"0","  ggtitle(""D. Impact on Mobility"") +"
"0","  theme(plot.title = element_text(size = 11, hjust = 0.5, face = ""bold"")) +"
"0","  coord_cartesian(ylim = c(-0.12, 0.04))"
"0",""
"0","main_title <- textGrob("
"0","  ""Transport Infrastructure Impact Analysis: Comprehensive Model Comparison"","
"0","  gp = gpar(fontsize = 14, fontface = ""bold"", col = ""black""))"
"0",""
"0","sub_title <- textGrob("
"0","  ""Northern Line Extension (NLE) vs Barking Riverside Extension (BRE)"","
"0","  gp = gpar(fontsize = 12, fontface = ""plain"", col = ""black""))"
"0",""
"0","final_plot <- grid.arrange("
"0","  main_title,"
"0","  sub_title,"
"0","  arrangeGrob(p1, p2, p3, p4, ncol = 2, nrow = 2),"
"0","  heights = c(0.06, 0.04, 0.9),"
"0","  ncol = 1)"
